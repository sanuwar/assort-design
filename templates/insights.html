{% extends "base.html" %}

{% block title %}Insights - Asort Design{% endblock %}

{% block content %}
  <div class="card">
    <h2>Insights</h2>
    <p class="muted">Recent accepted summaries with quick decision bullets.</p>
  </div>

  {% if items %}
    {% for item in items %}
      <div class="card">
        <div class="muted">
          <span
            class="{% if item.audience == 'Cross-Functional' %}tooltip{% endif %}"
            {% if item.audience == 'Cross-Functional' %}
              data-tip="Mixed stakeholders (see request for details)"
            {% endif %}
          >
            {{ item.audience }}
          </span>
          â€¢ {{ item.created_at }}
        </div>
        {% if item.summary and item.summary|length > 160 %}
          <h3>{{ item.summary[:160] }}...</h3>
          <details>
            <summary>Show full summary</summary>
            <p>{{ item.summary }}</p>
          </details>
        {% else %}
          <h3>{{ item.summary }}</h3>
        {% endif %}
        {% if item.bullets %}
          <ul>
            {% for bullet in item.bullets %}
              <li>{{ bullet }}</li>
            {% endfor %}
          </ul>
        {% else %}
          <p class="muted">No decision bullets available.</p>
        {% endif %}
        <div class="actions">
          <a class="button" href="/web/jobs/{{ item.job_id }}">View Request</a>
        </div>
      </div>
    {% endfor %}
    <div class="card">
      <div class="pagination">
        {% if has_prev %}
          <a class="button" href="/web/insights?page={{ page - 1 }}">Previous</a>
        {% endif %}
        <span class="muted">Page {{ page }}</span>
        {% if has_next %}
          <a class="button" href="/web/insights?page={{ page + 1 }}">Next</a>
        {% endif %}
      </div>
    </div>
  {% else %}
    <div class="card">
      <p class="muted">No insights yet. Run the pipeline on a document to see results here.</p>
    </div>
  {% endif %}
{% endblock %}
