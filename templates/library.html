{% extends "base.html" %}

{% block title %}Library - Asort Design{% endblock %}

{% block content %}
  <div class="card">
    <h2>Library</h2>
    <p class="muted">All documents with tags and key clues in one place.</p>
    <form method="get" action="/web/library">
      <div class="search-bar">
        <input type="text" name="q" placeholder="Search by keyword, tag, or clue" value="{{ query }}" />
        <button class="button" type="submit">Search</button>
        {% if query %}
          <a class="button" href="/web/library">Clear</a>
        {% endif %}
      </div>
    </form>
  </div>

  {% if items %}
    {% for item in items %}
      <div class="card">
        <div class="muted">
          <span
            class="{% if item.audience == 'Cross-Functional' %}tooltip{% endif %}"
            {% if item.audience == 'Cross-Functional' %}
              data-tip="Mixed stakeholders (see request for details)"
            {% endif %}
          >
            {{ item.audience }}
          </span>
          •
          <span class="status-chip status-{{ item.status }}">{{ item.status }}</span>
        </div>
        <p>{{ item.snippet }}</p>
        {% if item.tags %}
          <p class="muted"><strong>Tags:</strong> {{ item.tags | join(", ") }}</p>
        {% else %}
          <p class="muted">Tags: none yet.</p>
        {% endif %}
        {% if item.clues %}
          <p class="muted"><strong>Key clues:</strong> {{ item.clues | join(" • ") }}</p>
        {% else %}
          <p class="muted">Key clues: none yet.</p>
        {% endif %}
        <div class="actions">
          {% if item.job_id %}
            <a class="button" href="/web/jobs/{{ item.job_id }}">View Request</a>
          {% endif %}
          <a class="button" href="/web/documents/{{ item.document_id }}">View Source</a>
        </div>
      </div>
    {% endfor %}
      <div class="card">
        <div class="pagination">
          {% if has_prev %}
          <a class="button" href="/web/library?page={{ page - 1 }}{% if query %}&q={{ query }}{% endif %}">Previous</a>
          {% endif %}
          <span class="muted">Page {{ page }}</span>
          {% if has_next %}
          <a class="button" href="/web/library?page={{ page + 1 }}{% if query %}&q={{ query }}{% endif %}">Next</a>
          {% endif %}
        </div>
      </div>
  {% else %}
    <div class="card">
      <p class="muted">No documents yet.</p>
    </div>
  {% endif %}
{% endblock %}
